---
layout: post
title: Bisection Method
categories : posts
tags: [Mathematics, Programming, Numerical Methods]
published: false
date-string: AUGUST 12, 2020
---

# วิธีการแบ่งครึ่งช่วง (Bisection Method)

ถ้าผมชวนคุณเล่นเกมทายตัวเลขตั้งแต่ 1 ถึง 100 โดยในแต่ละครั้งที่คุณเลือกตัวเลขนั้นผมจะบอกว่าเลขที่คุณเลือกนั้น **สูงไป** หรือ **ต่ำไป** คุณจะใช้วิธีไหนในการทายตัวเลข

แน่นอนว่าวิธีหนึ่งที่ตรงไปตรงมาก็คือการไล่ตัวเลขตั้งแต่ 1 ไปจนถึง 100 แต่มันก็เป็นการดูแคลนข้อมูลที่เราทราบว่าเลขที่เราเลือกนั้นสูงไปหรือต่ำไป

เราจึงมีอีกวิธีการหนึ่งที่เรียกว่าการค้นหาแบบทวิภาค (Binary Search) ซึ่งมีขั้นตอนแบบคร่าวๆคือ

1. กำหนดช่วงของการค้นหา (ในที่นี่คือ 1 ถึง 100) เรียกขอบเขตด้านซ้ายว่า $a$ และด้านขวาว่า $b$
2. หา**จุดกึ่งกลาง**ของขอบเขตปัจจุบันได้จาก $c = \frac{(a+b)}{2}$
3. พิจาราณาว่าค่าปัจจุบัน ($c$)  ที่เรามีนั้นสูงไปหรือว่าต่ำไป
    * ถ้าค่า $c$ สูงไปแสดงว่าตัวเลขที่เราต้องการหาอยู่ในช่วง $[a, c)$
    * ถ้าหากว่าค่าต่ำไปแสดงว่าตัวเลขที่เราต้องการอยู่ในช่วง $[c, b)$
4. ทำการเปลี่ยนแปลงค่าของขอบเขตการค้นหา
5. ทำขั้นตอนที่ 2 ถึง 5 จนกระทั้งเจอคำตอบ

ด้วยการที่วิธีการนี้ทำการปรับปรุงประสิทธิภาพการค้นหาด้วยการตัดการค้นหาที่ไม่จำเป็นออกไปโดยพึ่งพาข้อสมมติฐานข้อหนึ่งก็คือ**สิ่งที่เราค้นหานั้นมีการเรียง**

> ถ้าเราคำนวณความซับซ้อนเชิงเวลาในการคำนวณจะได้ว่าการค้นหาแบบตรงนั้นมีความซับซ้อนเป็น $O(n)$ แต่การค้นหาแบบทวิภาคนั้นเป็น $O(log_2(n))$ 

>สามารถอ่านเรื่องการ้นหาแบบทวิภาคได้เพิ่มเติมจากบทความของคุณ @Aquablitz [ได้ที่นี่](https://aquablitz11.github.io/2019/04/12/complete-bsearch-tutorial.html#%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B9%83%E0%B8%8A%E0%B9%89-binary-search-%E0%B9%83%E0%B8%99%E0%B8%81%E0%B8%B2%E0%B8%A3%E0%B9%81%E0%B8%81%E0%B9%89-optimization-problem)

## การหาผลเฉลยของสมการไม่เชิงเส้นด้วยวิธีการแบ่งครึ่งช่วง
แต่ในบทความนี้เราจะเน้นไปที่การหารากของสมการไม่เชิงเส้น (nonlinear equation) โดยเราจะเรียก $r$ ว่าเป็นรากของสมการไม่เชิงเส้นเมื่อ
$$ f(r) = 0$$
โดยที่ $f$ เป็นฟังก์ชันไม่เชิงเส้น
ตัวอย่างเช่น
* $x^3 - x^2 - x + 1 = 0$
* $x - 4.5(x - sin(x)) = 0$
* $xe^{0.5x}+1.2x-5 = 0$

การค้นหารากด้วยวิธีการแบ่งครึ่งช่วง (Bisection method) นั้นมีความคล้ายคลึงกันกับการค้นหาแบบทวิภาคแต่ว่าวิธีการนี้ขึ้นตรงกับทฤษฎีบทต่อไปนี้

**Intermediate Value Theorem**: กำหนดให้ $f$ เป็นฟังก์ชันต่อเนื่องบนช่วง $[a, b]$ และ $k$ เป็นจำนวนจริงที่อยู่ระหว่าง $f(a)$ และ $f(b)$ จะมีจำนวนจริง $c$ ภายใต้เงื่อนไข $a < c < b$ ที่ทำให้ $f(c) = k$

ในอีกความหมายหนึ่งคือถ้ามีจำนวนจริงสองตัวที่ค่าฟังก์ชันของมันครอบจำนวนจริง $k$ แสดงว่าเรามีจำนวนจริงสักตัวที่อยู่ระหว่างจำนวนจริงสองตัวนั้นที่ค่าของฟังก์ชันมันเป็น $k$

หลักการนี้สามารถต่อยอดได้ไปถึงการกำหนดเงื่อนไขการลู่เข้าของวิธีการนี้ นั่นก็คือการรับประกันว่าในช่วงที่เราาสนใจเราจะสามารถหารากได้ด้วยวิธีการนี้ได้นั่นก็คือ

**Simple enclosure methods**: ถ้า $f(a)$ และ $f(b)$ มีเครื่องหมายต่างกันแล้วจะมีรากอย่างน้อย 1 ค่าในช่วง $[a, b]$

ซึ่งหลักการนี้ถือว่าเข้าใจได้ง่ายโดยเงื่อนไขที่เรากำหนดไว้ก็คือ
* $f$ เป็นฟังก์ชันต่อเนื่อง (เส้นกราฟไม่ขาดตอน)
* $f(a)$ กับ $f(b)$ มีเครื่องหมายแตกต่างกัน

ดังนั้นเส้นกราฟของฟังก์ชันเราต้องไปตัดที่แกน x แน่ๆ ตรงจุดนั้นล่ะคือจุดที่เป็นรากของสมการเพราะเป็นจุดที่$f(x) = 0$

ท้ายที่สุดก็คือการใช้วิธีการแบ่งครึ่งในช่วงที่เราสนใจตามกระบวนการดังนี้

1. เลือกช่วง $[a, b]$ ที่ $f(a)f(b) < 0$ (เครื่องหมายแตกต่างกัน)
2. กำหนดให้ $[a, b]$ เป็น $[a_n, b_n], n = 0$
3. คำนวณค่าจุดกึ่งกลาง $c_n = \frac{a_n+b_n}{2}$
4. พิจารณาเครื่องหมายของผลคูณ $f(a_n)f(c_n)$
   * ถ้าเครื่องหมายเป็นลบ นั่นคือ $r$ อยู่ระหว่าง $a_n$ และ $c_n$
   * ถ้าเครื่องหมายเป็นบวก นั่นคือ $r$ อยู่ระหว่าง $c_n$ และ $b_n$
   * ถ้าเป็น 0 นั่นคือ $r = c_n$ 
5. เปลี่ยนแปลงค่า $n = n+1$ และเลือกช่วงในการค้นหาที่มี $r$ อยู่ในนั้นและตั้งชื่อว่าเป็น $[a_n, b_n]$
6. ทำขั้นตอนที่ 3 จนถึง 5 ซ้ำไปเรื่อยๆจนถึงเงื่อนไขการหยุดการทำซ้ำ


**ตัวอย่าง**

สมการ $x^{3}-x^{2}-x+1 = 0$ บนช่วง [-1.2, 1.2]

ถ้าเราหาค่าฟังก์ชันนี้สำหรับทุกค่า $x$ ในช่วง [-1.2, 1.2] โดยเพิ่มทีละ 0.3 จะได้ค่าดังนี้

| $x$ | $f(x)$ |
|:----:| :----:  |
|-1.2 |-0.968  |
|-0.9 |0.361   |
|-0.6 |1.024   |
|-0.3 |1.183   |
|0.0  |1.000   |
|0.3  |0.637   |
|0.6  |0.256   |
|0.9  |0.019   |
|1.2  |0.088   |

จะพบว่าช่วง $[-1.2, -0.9]$ นั้นมีเครื่องหมายที่แตกต่างกันจึงทำให้เรามั่นใจได้ว่ารากของสมการต้องอยู่ในช่วงนี้ เราจึงเลือกช่วงนี้เป็นขอบเขตในการค้นหาครั้งแรกคือ $a = -1.2,  b = -0.9$

การคำนวณหารากนั้นสามารถทำได้หลายวิธีทั้งการคำนวณด้วยการคิดเลขเองหรือใช้โปรแกรมช่วยทั้งการใช้โปรแกรม excel หรือการเขียนโปรแกรมขึ้นมาเองในที่นี้ผู้เขียนจะเขียนโปรแกรมตามขั้นตอนวิธีขั้นต้นด้้วยภาษา C++ กับภาษา Python

### C++ Source code
```cpp
#include<bits/stdc++.h>
using namespace std;

double fval(double x){
    return pow(x, 3) - pow(x, 2) - x + 1;
}

int main(){
    double a = -1.2, b = -0.9, c;
    int n = 0;
    while(n <= 14){
        c = (a+b)/2;
        cout << "n = " << n << ": " << "\n";
        cout << "search in range: [ " << a << ", " << b << " ]" << "\n";
        cout << "c = " << c << " and f(c) = " << fval(c) << "\n";
        double product = fval(a) * fval(c);
        if(product < 0)
            b = c;
        else if(product > 0)
            a = c;
        else{
            cout << "Find Solution!\n r = " << c;
            break;
        }
        n++;
    }
    return 0;
}
```
### C++ Result

### Python Source code
```python
def fval(x):
    return x**3 - x**2 - x + 1
a = -1.2
b = -0.9
n = 0
while n <= 14:
    c = (a + b)/2
    print(f'n = {n}:')
    print(f'search in range: [ {a}, {b} ]')
    print(f'c = {c} and f(c) = {fval(c)}')
    product = fval(a) * fval(c)
    if product < 0:
        b = c
    elif product > 0:
        a = c
    else :
        print(f'find solution! r = {c}')
        break
    n = n + 1
```
### Python Result


### เงื่อนไขเพิ่มเติมในการคำนวณ

จาก source code ด้านบนผู้เขียนตั้งเงื่อนไชในการหยุดการคำนวณคือจำนวนครั้งในการทำซ้ำ (ทำซ้ำจำนวน 15 ครั้ง) แต่เราสามารถกำหนดเงื่อนไขการหยุดทำซ้ำได้อีกหลากหลายรูปแบบเช่น

* ความแตกต่างของรากที่ได้จากการคำนวณ: $|x_n - x_{n-1}| \leq \epsilon$
* การกำหนดขอบเขตความคลาดเคลื่่อน: $|f(x)| = |0-f(x_n)| = |f(x_n)| \leq \delta$

### การลู่เข้าของวิธีแบ่งครึ่งช่วง
ในบางครั้งเราอาจมีขอบเขตความคลาดเคลื่อนที่ยอมรับได้ และเราจำเป็นต้องกำหนดจำนวนการทำซ้ำที่เหมาะสมในการหารากของสมการเราสามารถใช้ทฤษฎีต่อไปนี้เพื่อประมาณจำนวนครั้งที่เหมาะสมได้

ถ้าเรากำหนดให้ $f$ นั้นต่อเนื่องบน $[a, b]$ และ $f(b)f(a) < 0$ เมื่อเราใช้วิธีการแบ่งครึ่งช่วง จะได้ว่า ${x_n}$ นั้นลู่่เข้าสู่ $r$ ที่เป็นรากของสมการ $f(x) = 0$ และ $|e_n| = |r-x_n| \leq |\frac{b-a}{2^{n+1}}| \leq \epsilon$ เมื่อ $|e_n|$ คือค่าความคลาดเคลื่อนในการทำซ้ำรอบที่ n และ $\epsilon$ คือขอบเขตความคาดเคลื่อนที่เราพึงพอใจ

จากทฤษฎีข้างต้นเราสามารถจัดรูปอสมการต่อได้เป็น
$$ln(|b-a|) - (n+1)ln(2) \leq ln(\epsilon)$$
$$n+1 \geq \frac{ln(|b-a|) - ln(\epsilon)}{ln(2)}$$


เมื่อเรานำสูตรข้างต้นไปแทนค่าด้วยตัวอย่างโจทย์ของเราที่ $a =-1.2$ และ $b = -0.9$ และกำหนดให้ขอบเขตความคลาดเคลื่อนเท่ากับ $0.5 \times 10^{-4}$ จะได้ว่า
$$n + 1 \geq \frac{ln(0.3) - ln(0.5 \times 10^{-4})}{ln(2)}$$
$$n+1 >= 12.55$$

ซึ่งก็คือทำไปจนกระทั่ง $n = 12$ นั้่นก็คือทำเป็นจำนวน 13 ครั้งเพื่อให้ได้ความคลาดเคลื่อนไม่เกินที่กำหนดไว้ก็ถือว่าเพียงพอแล้ว

